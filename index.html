<html>
  <head>
    <title>GetRides</title>
  </head>
  <body style = "font-family: Arial; font-size: 30px; background-color: thistle">
    <div id="loads">Loading...</div>
    <script>
  
      async function getData(){
        
      const originalString = "API_KEY:3bjz27ydq97vjwmrc7f8u12oo";
      const base64Encoded = btoa(originalString);
      const currentYear = new Date().getFullYear()+'-01-01';
  
try {
  const response = await fetch('https://intervals.icu/api/v1/athlete/0/activities?oldest='+currentYear+'&fields=type&fields=distance&fields=start_date_local&fields=total_elevation_gain&fields=moving_time', {
    headers: {
      "Authorization": `Basic ${base64Encoded}`,
      "Accept": "application/json"
    }
  });
  const data = await response.json();
  
  let rideCount = new Array(12).fill(0);
  let rideDistance = new Array(12).fill(0);
  let rideElevation = new Array(12).fill(0);
  let rideMovingTime = new Array(12).fill(0);

  let virtualRideCount = new Array(12).fill(0);
  let virtualRideDistance = new Array(12).fill(0);

  let monthIndex;

  data.forEach((ride) => {
    monthIndex = ride.start_date_local.getMonth();
    if (ride.type == "VirtualRide"){
      virtualRideCount[monthIndex]++;
      virtualRideDistance[monthIndex] += ride.distance/1000;
    } else {
      rideCount[monthIndex]++;
      rideDistance[monthIndex] += ride.distance/1000;
      rideElevation[monthIndex] += ride.total_elevation_gain;
      rideMovingTime[monthIndex] += ride.moving_time;
    }
  }
    );
  
    console.log(rideCount, rideDistance, rideElevation, rideMovingTime, virtualRideCount, virtualRideDistance);
//    document.getElementById("loads").innerHTML = `<p>Real Rides: ${rideCount}, Distance: ${Math.round(rideDistance)} km, Elevation: ${Math.round(rideElevation)} m, Moving Time: ${rideMovingTime} s</p><p>Virtual Rides: ${virtualRideCount}, Distance: ${Math.round(virtualRideDistance)}km</p>`;

    
} catch(error) {
  console.error('Fetch error:', error);
  document.getElementById("loads").innerHTML = 'Error loading wellness data';
}
        
      } // async function getData()
      getData();
    </script>
  </body>
</html>
